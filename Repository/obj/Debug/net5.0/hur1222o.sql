CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;

CREATE TABLE "CategoriaProduto" (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome varchar(200) NOT NULL,
    active char(1) NOT NULL,
    created_at datetime NOT NULL,
    CONSTRAINT "PK_CategoriaProduto" PRIMARY KEY (id)
);

CREATE TABLE "Cidades" (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome varchar(250) NOT NULL,
    uf char(2) NOT NULL,
    codigo_ibge integer NOT NULL,
    active char(1) NOT NULL,
    created_at datetime NOT NULL,
    CONSTRAINT "PK_Cidades" PRIMARY KEY (id)
);

CREATE TABLE "Imagens" (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome char(250) NOT NULL,
    caminhoarquivo char(250) NOT NULL,
    principal char(1) NOT NULL,
    created_at datetime NOT NULL,
    CONSTRAINT "PK_Imagens" PRIMARY KEY (id)
);

CREATE TABLE "Produtos" (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome char(150) NOT NULL,
    descricao char(250) NOT NULL,
    preco numeric(18,2) NOT NULL,
    codigo char(50) NOT NULL,
    ean char(30) NOT NULL,
    id_categoria integer NOT NULL,
    active char(1) NOT NULL,
    created_at datetime NOT NULL,
    CONSTRAINT "PK_Produtos" PRIMARY KEY (id),
    CONSTRAINT "FK_Produtos_CategoriaProduto_id_categoria" FOREIGN KEY (id_categoria) REFERENCES "CategoriaProduto" (id) ON DELETE CASCADE
);

CREATE TABLE "Enderecos" (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    tipo smallint NOT NULL,
    logradouro varchar(350) NOT NULL,
    bairro char(250) NOT NULL,
    numero char(50) NOT NULL,
    complemento char(250) NULL,
    cep char(20) NULL,
    id_cidade integer NOT NULL,
    created_at datetime NOT NULL,
    CONSTRAINT "PK_Enderecos" PRIMARY KEY (id),
    CONSTRAINT "FK_Enderecos_Cidades_id_cidade" FOREIGN KEY (id_cidade) REFERENCES "Cidades" (id) ON DELETE CASCADE
);

CREATE TABLE "Combos" (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome char(250) NOT NULL,
    preco numeric(18,5) NOT NULL,
    id_imagem integer NOT NULL,
    id_produto integer NOT NULL,
    active char(1) NOT NULL,
    created_at datetime NOT NULL,
    CONSTRAINT "PK_Combos" PRIMARY KEY (id),
    CONSTRAINT "FK_Combos_Imagens_id_imagem" FOREIGN KEY (id_imagem) REFERENCES "Imagens" (id) ON DELETE CASCADE
);

CREATE TABLE "ImagensProdutos" (
    id_imagem integer NOT NULL,
    id_produto integer NOT NULL,
    CONSTRAINT "PK_ImagensProdutos" PRIMARY KEY (id_imagem, id_produto),
    CONSTRAINT "FK_ImagensProdutos_Imagens_id_imagem" FOREIGN KEY (id_imagem) REFERENCES "Imagens" (id) ON DELETE CASCADE,
    CONSTRAINT "FK_ImagensProdutos_Produtos_id_produto" FOREIGN KEY (id_produto) REFERENCES "Produtos" (id) ON DELETE CASCADE
);

CREATE TABLE "PromocaoProduto" (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome char(150) NOT NULL,
    preco numeric(18,2) NOT NULL,
    id_imagem integer NOT NULL,
    id_produto integer NOT NULL,
    active char(1) NOT NULL,
    created_at datetime NOT NULL,
    CONSTRAINT "PK_PromocaoProduto" PRIMARY KEY (id),
    CONSTRAINT "FK_PromocaoProduto_Imagens_id_imagem" FOREIGN KEY (id_imagem) REFERENCES "Imagens" (id) ON DELETE CASCADE,
    CONSTRAINT "FK_PromocaoProduto_Produtos_id_produto" FOREIGN KEY (id_produto) REFERENCES "Produtos" (id) ON DELETE CASCADE
);

CREATE TABLE "Clientes" (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome char(150) NOT NULL,
    cpfcnpj char(20) NOT NULL,
    id_endereco integer NOT NULL,
    active char(1) NOT NULL,
    created_at datetime NOT NULL,
    CONSTRAINT "PK_Clientes" PRIMARY KEY (id),
    CONSTRAINT "FK_Clientes_Enderecos_id_endereco" FOREIGN KEY (id_endereco) REFERENCES "Enderecos" (id) ON DELETE CASCADE
);

CREATE TABLE "ProdutosCombo" (
    id_produto integer NOT NULL,
    id_combo integer NOT NULL,
    CONSTRAINT "PK_ProdutosCombo" PRIMARY KEY (id_produto, id_combo),
    CONSTRAINT "FK_ProdutosCombo_Combos_id_combo" FOREIGN KEY (id_combo) REFERENCES "Combos" (id) ON DELETE CASCADE,
    CONSTRAINT "FK_ProdutosCombo_Produtos_id_produto" FOREIGN KEY (id_produto) REFERENCES "Produtos" (id) ON DELETE CASCADE
);

CREATE TABLE "Pedidos" (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    numero char(250) NOT NULL,
    valor numeric(18,5) NOT NULL,
    dt_entrega interval NOT NULL,
    id_cliente integer NOT NULL,
    created_at datetime NOT NULL,
    CONSTRAINT "PK_Pedidos" PRIMARY KEY (id),
    CONSTRAINT "FK_Pedidos_Clientes_id_cliente" FOREIGN KEY (id_cliente) REFERENCES "Clientes" (id) ON DELETE CASCADE
);

CREATE TABLE "ProdutosPedidos" (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    quantidade integer NOT NULL,
    preco numeric(18,2) NOT NULL,
    id_produto integer NOT NULL,
    id_pedido integer NOT NULL,
    created_at datetime NOT NULL,
    CONSTRAINT "PK_ProdutosPedidos" PRIMARY KEY (id),
    CONSTRAINT "FK_ProdutosPedidos_Pedidos_id_pedido" FOREIGN KEY (id_pedido) REFERENCES "Pedidos" (id) ON DELETE CASCADE,
    CONSTRAINT "FK_ProdutosPedidos_Produtos_id_produto" FOREIGN KEY (id_produto) REFERENCES "Produtos" (id) ON DELETE CASCADE
);

CREATE UNIQUE INDEX "IX_Clientes_id_endereco" ON "Clientes" (id_endereco);

CREATE INDEX "IX_Combos_id_imagem" ON "Combos" (id_imagem);

CREATE INDEX "IX_Enderecos_id_cidade" ON "Enderecos" (id_cidade);

CREATE INDEX "IX_ImagensProdutos_id_produto" ON "ImagensProdutos" (id_produto);

CREATE INDEX "IX_Pedidos_id_cliente" ON "Pedidos" (id_cliente);

CREATE INDEX "IX_Produtos_id_categoria" ON "Produtos" (id_categoria);

CREATE INDEX "IX_ProdutosCombo_id_combo" ON "ProdutosCombo" (id_combo);

CREATE INDEX "IX_ProdutosPedidos_id_pedido" ON "ProdutosPedidos" (id_pedido);

CREATE INDEX "IX_ProdutosPedidos_id_produto" ON "ProdutosPedidos" (id_produto);

CREATE INDEX "IX_PromocaoProduto_id_imagem" ON "PromocaoProduto" (id_imagem);

CREATE INDEX "IX_PromocaoProduto_id_produto" ON "PromocaoProduto" (id_produto);

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20210718000553_Initi_Migration', '5.0.5');

COMMIT;

